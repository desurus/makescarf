/**
	TinyMCE Placeholder v1.0 - December 2013
	(c) 2013 Federico Isacchi - http://www.isacchi.eu
	license: http://www.opensource.org/licenses/mit-license.php

A customizable placeholder plugin for TinyMCE 4.
It can be used to create image placeholders for tokens like [!token_name].

Into the configuration of TineMCE 'placeholder_tokens' should be declared as an
array of objects.
Each object can have the following properties:
	token	The token name.
	title	[optional] The text that will be used into the menus.
	image	[optional] The image url that will be used as placeholder.
*/
tinymce.PluginManager.add("placeholder",function(g,e){var h=g.getParam("placeholder_tokens",[]);function c(l){var a,k;for(a=h.length-1;a>=0;a--){k=new RegExp("\\[\\!"+h[a].escapedToken+"\\](?![^\\<\\>]*>)","gi");l=l.replace(k,"[&#x21;"+h[a].token+"]");k=new RegExp('<img[^\\>]+placeholder_data\\=\\"'+h[a].escapedToken+'\\"[^\\>]*>',"gi");l=l.replace(k,"[!"+h[a].token+"]")}return l}function b(l){var a,k;for(a=h.length-1;a>=0;a--){k=new RegExp("\\[\\!"+h[a].escapedToken+"\\](?![^\\<\\>]*\\>)","gi");l=l.replace(k,'<img src="'+h[a].image+'" placeholder_data="'+h[a].token+'">')}return l}if(g.settings.extended_valid_elements==undefined){g.settings.extended_valid_elements="img[src|alt|usemap|ismap|width|height|class|placeholder_data]"}else{var f=g.settings.extended_valid_elements.search(/img[\s]*\[[^\[\]]+\]/i);if(f==-1){g.settings.extended_valid_elements+=",img[src|alt|usemap|ismap|width|height|class|placeholder_data]"}else{var d=g.settings.extended_valid_elements.substr(f);d=d.substr(d.indexOf("[")+1);g.settings.extended_valid_elements=g.settings.extended_valid_elements.substring(0,f)+"img[placeholder_data|"+d}}var j=new Array();for(var f=h.length-1;f>=0;f--){if(h[f].title==undefined){h[f].title=h[f].token}j.push({text:h[f].title,token:h[f].token});h[f].escapedToken=h[f].token.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");if(h[f].image==undefined){h[f].image=e+"/placeholder.gif"}}g.addButton("placeholder",{text:"Placeholder",type:"listbox",values:j,onselect:function(a){g.insertContent("[!"+a.control.settings.token+"]")}});g.addMenuItem("placeholder",{text:"Placeholder",context:"insert",menu:j,onselect:function(a){g.insertContent("[!"+a.control.settings.token+"]")}});g.on("beforeSetContent",function(a){a.content=b(a.content)});g.on("postProcess",function(a){a.content=c(a.content)})});